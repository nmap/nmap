#!/usr/bin/env python3
"""
Generate a formatted PR comment from benchmark results
"""

import sys
from pathlib import Path

def generate_pr_comment(summary_file: Path):
    """Generate a GitHub PR comment from benchmark summary"""
    
    with open(summary_file, 'r') as f:
        summary = f.read()
    
    # Extract key information
    lines = summary.split('\n')
    
    # Find pass/fail status
    overall_status = "âš ï¸ Unknown"
    for line in lines:
        if 'âœ… PASS' in line:
            overall_status = "âœ… PASS"
            break
        elif 'âŒ FAIL' in line:
            overall_status = "âŒ FAIL"
            break
    
    # Create PR comment
    comment = f"""## ğŸ“Š Performance Benchmark Results

{overall_status}

<details>
<summary><b>Click to see detailed benchmark results</b></summary>

{summary}

</details>

---

### What this means:

- âœ… **PASS**: R-Map's performance is within 20% of nmap (acceptable range)
- âŒ **FAIL**: Performance regression detected - needs optimization before merge

### Performance Criteria:
- **Speed**: Within Â±20% of nmap
- **Memory**: Within Â±20% of nmap
- **Accuracy**: 100% detection rate match

### Next Steps:
{'âœ… Performance is good - ready to merge!' if overall_status == 'âœ… PASS' else 'âŒ Please investigate performance regressions before merging.'}

---

*Generated by [R-Map Benchmark Suite](https://github.com/Ununp3ntium115/R-map/tree/main/benchmarks)*
"""
    
    print(comment)

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 generate_pr_comment.py <SUMMARY.md>")
        sys.exit(1)
    
    summary_file = Path(sys.argv[1])
    
    if not summary_file.exists():
        print(f"Error: Summary file not found: {summary_file}")
        sys.exit(1)
    
    generate_pr_comment(summary_file)

if __name__ == '__main__':
    main()
